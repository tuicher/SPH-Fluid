// FindCellBounds.comp
#version 460
layout(local_size_x = 256) in;

layout(std430, binding = 0) readonly  buffer Keys      { uint keys[]; };
layout(std430, binding = 1) writeonly buffer CellStart { int  cellStart[]; };
layout(std430, binding = 2) writeonly buffer CellEnd   { int  cellEnd[]; };

layout(location = 0) uniform uint uNumParticles;

void main()
{
    uint i = gl_GlobalInvocationID.x;
    if (i >= uNumParticles) return;

    uint key = keys[i];

    // primer índice de la celda
    if (i == 0u || key != keys[i - 1])
        atomicMin(cellStart[key], int(i));

    // último índice  (exclusive)
    if (i == uNumParticles - 1u || key != keys[i + 1])
        atomicMax(cellEnd[key], int(i + 1));
}